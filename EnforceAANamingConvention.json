{
  "properties": {
    "policyType": "Custom",
    "displayName": "Marel - Enforce AA naming convention",
    "description": "Azure Automation account naming convention",
    "mode": "All",
    "Category": "Naming Convention",
    "metadata": {
      "category": "Naming Convention",
      "version": "1.0.0"
    },
    "parameters": {
      "policyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Policy Effect",
          "description": "The desired effect of the policy."
        },
        "allowedValues": [
          "audit",
          "Audit",
          "deny",
          "Deny",
          "disabled",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "environment": {
        "type": "array",
        "defaultValue": [
          "prd",
          "stg",
          "tst",
          "dev"
        ]
      },
      "location": {
        "type": "array",
        "defaultValue": [
          "euw",
          "brs",
          "aue",
          "usc",
          "jae",
          "inc",
          "inw",
          "ins",
          "eun",
          "usa",
          "sdc"
        ]
      },
      "resourcetype": {
        "type": "array",
        "defaultValue": [
          "aa"
        ]
      },
      "counter": {
        "type": "array",
        "defaultValue": [
          "001",
          "002",
          "003",
          "004",
          "005",
          "006",
          "007",
          "008",
          "009",
          "010",
          "011",
          "012",
          "013",
          "014",
          "015",
          "016",
          "017",
          "018",
          "019",
          "020"
        ]
      }
    },
    "policyRule": {
      "if": {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.Automation/automationAccounts"
          },
          {
            "anyOf": [
              {
                "count": {
                  "value": [
                    "az"
                  ],
                  "name": "pattern",
                  "where": {
                    "value": "[split(field('name'), '-')[0]]",
                    "like": "[current('pattern')]"
                  }
                },
                "notEquals": 1
              },
              {
                "count": {
                  "value": "[parameters('environment')]",
                  "name": "pattern",
                  "where": {
                    "value": "[split(field('name'), '-')[1]]",
                    "like": "[current('pattern')]"
                  }
                },
                "notEquals": 1
              },
              {
                "count": {
                  "value": "[parameters('location')]",
                  "name": "pattern",
                  "where": {
                    "value": "[split(field('name'), '-')[2]]",
                    "like": "[current('pattern')]"
                  }
                },
                "notEquals": 1
              },
              {
                "count": {
                  "value": "[parameters('resourcetype')]",
                  "name": "pattern",
                  "where": {
                    "value": "[split(field('name'), '-')[4]]",
                    "like": "[current('pattern')]"
                  }
                },
                "notEquals": 1
              },
              {
                "count": {
                  "value": "[parameters('counter')]",
                  "name": "pattern",
                  "where": {
                    "value": "[split(field('name'), '-')[5]]",
                    "like": "[current('pattern')]"
                  }
                },
                "notEquals": 1
              }
            ]
          }
        ]
      },
      "then": {
        "effect": "[parameters('policyEffect')]"
      }
    }
  },
  "name": "AA naming convention",
  "type": "Microsoft.Authorization/policyDefinitions"
}
